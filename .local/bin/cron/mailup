#!/bin/sh

# Set as a cron job to check for new RSS entries for newsboat.
# If newsboat is open, sends it an "R" key to refresh.

#ping -q -c 1 example.org > /dev/null || exit
wget -q --spider example.org || exit

/usr/bin/notify-send "ðŸ“¬ Updating Mails..."

# pgrep -f neomutt$ && /usr/bin/xdotool key --window "$(/usr/bin/xdotool search --name neomutt)" R && exit

echo "MailðŸ”ƒ" > /tmp/mailupdate.tmp
pkill -RTMIN+12 "${STATUSBAR:-dwmblocks}"
mw -Y >/dev/null 2>&1
unread="$(find "${XDG_DATA_HOME:-$HOME/.local/share}"/mail/*/*/new/* -type f 2>/dev/null | wc -l 2>/dev/null)"

# [ "$unread" = "0" ] && [ "$icon" = "" ] || echo "ðŸ“¬$unread$icon" > /tmp/mailupdate
if [ "$unread" -gt 0 ]; then
  echo "ðŸ“¬$unread" > /tmp/mailupdate.tmp
else
  echo "" > /tmp/mailupdate.tmp
fi


pkill -RTMIN+12 "${STATUSBAR:-dwmblocks}"
/usr/bin/notify-send "ðŸ“¬ Mail update complete."
