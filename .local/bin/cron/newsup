#!/bin/sh

# Set as a cron job to check for new RSS entries for newsboat.
# If newsboat is open, sends it an "R" key to refresh.

#ping -q -c 1 example.org > /dev/null || exit

if [ -n "$1" ]; then
  if [ "$1" = "update" ]; then
      wget -q --spider example.org || exit

      /usr/bin/notify-send "ðŸ“° Updating RSS feeds..."

      pgrep -f newsboat$ && /usr/bin/xdotool key --window "$(/usr/bin/xdotool search --name newsboat)" R && exit

      echo "NewsðŸ”ƒ" > /tmp/newsupdate.tmp
      pkill -RTMIN+6 "${STATUSBAR:-dwmblocks}"
      /usr/bin/newsboat -x reload
  fi
fi

echo "$(newsboat -x print-unread | awk '{ if($1>0) 
                                              print "ðŸ“°" $1 
                                          else 
                                              print ""}')"  > /tmp/newsupdate.tmp
pkill -RTMIN+6 "${STATUSBAR:-dwmblocks}"
/usr/bin/notify-send "ðŸ“° RSS feed update complete."
